<ng-template #headerTpl>
	<div class="d-flex flex-grow-1 align-items-center text-truncate">
		<div class="card-icon primary-icon fas fa-brain me-2" aria-hidden="true"></div>
		<div class="card-title text-truncate mb-0 py-1 me-auto">
			{{'msg#machine-learning.passages' | sqMessage }}
		</div>
	</div>
</ng-template>

<div class="card-body p-0">
	<span *ngIf="passages && documentsNb" class="sq-passage-count p-2">{{'msg#machine-learning.passagesFound' |
		sqMessage:{passagesNb: passages.length, documentsNb: documentsNb} }}</span>

  <div class="border-top border-bottom" *ngIf="loadingSummary">
    <div class="spinner-grow text-success d-block mx-auto my-5" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

	<sq-chat *ngIf="chat"
    [chat]="chat"
    [searchMode]="false"
    [temperature]="summarizerConfig.modelTemperature"
    [topP]="summarizerConfig.modelTopP"
    [maxTokens]="summarizerConfig.modelMaxTokens"
    class="d-block border-top border-bottom"
    (data)="summarizeAction.disabled = false">
  </sq-chat>

	<div *ngFor="let passage of passages" (click)="openPreview(passage)" class="passage pt-2">

    <div class="sq-passage-title d-flex align-content-center mb-1" *ngIf="passage.$record">
			<input type="checkbox"
        class="form-check-input me-2 flex-shrink-0"
        [(ngModel)]="passage.$checked"
				(ngModelChange)="passageChecked()"
        (click)="$event.stopPropagation()">
			<sq-result-title
        [record]="passage.$record"
        titleLinkBehavior="action"
				(titleClicked)="onTitleClicked($event, passage)"
        class="d-block text-truncate">
      </sq-result-title>
		</div>

		<div class="sq-passage-text mb-2">
			<span *ngIf="passage.$record?.modified && !hideDate" class="extracts-date">
        {{passage.$record.modified | sqDate:dateFormat }} -
      </span>
			<span [innerHTML]="passage.highlightedText"></span>
		</div>

	</div>
</div>

<ng-template #settingsTpl>
  <sq-summary-settings [config]="summarizerConfigEdit"></sq-summary-settings>
</ng-template>
